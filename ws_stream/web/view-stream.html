<!DOCTYPE html>
<html>
<head>
	<title>JSMpeg Stream Client</title>
	<style type="text/css">
		html, body {
			background-color: #111;
			text-align: center;
		}
	</style>
	
</head>
<body>
	<canvas id="video-canvas" height=500 width=500></canvas>
	<script src="http://cdn.shinobi.video/js/jsmpeg.pipe.js"></script>
	<script src="https://cdn.socket.io/3.1.3/socket.io.min.js"></script>
	<!-- <script type="text/javascript" src="jsmpeg.min.js"></script> -->
	<script type="text/javascript">
		var canvas = document.getElementById('video-canvas');
		var player = new JSMpeg.Player('pipe', {canvas: canvas});

		var socket = io.connect('http://'+document.location.hostname+':8082/');
		socket.on('connect',function() {
			console.log('connected');
	
			socket.on('stream', function (data) {
				// `data.buffer` is the raw video data from FFMPEG
				// pretend you are getting data as follows
				// var data = {buffer:ArrayBuffer}
				console.log('recieved buffer');
				try {
				player.write(data);
				} catch(err){}
			});
			socket.on('data', function (data) {
				console.log('recieved data');
			})
			socket.on('message', function (data) {
				console.log('recieved message');
			})
		});
		socket.on('disconnect',function(){
			console.log('connected');
		});

		function onSliderUpdate(value) {
			socket.emit('buffer', value);
		}
		
	</script>
	<input type="range" min="256" max="20480" value="1024" step="256" class="slider" id="buffer" onchange="onSliderUpdate(this.value)">
</body>
</html>
